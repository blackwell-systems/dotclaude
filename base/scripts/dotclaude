#!/bin/bash
# dotclaude - profile management for Claude Code
# Go-only implementation (v1.0.0-rc.1+)

set -e

# Determine repo directory (respect env var or calculate from script location)
if [ -n "$DOTCLAUDE_REPO_DIR" ]; then
    REPO_DIR="$DOTCLAUDE_REPO_DIR"
else
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    REPO_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"
fi

GO_BINARY="$REPO_DIR/bin/dotclaude-go"

# Check if Go binary exists
if [ ! -x "$GO_BINARY" ]; then
    echo "Error: Go binary not found at $GO_BINARY" >&2
    echo "" >&2
    echo "To build:" >&2
    echo "  cd $REPO_DIR && make build" >&2
    echo "" >&2
    echo "Or install via go:" >&2
    echo "  go install github.com/blackwell-systems/dotclaude/cmd/dotclaude@latest" >&2
    exit 1
fi

exec "$GO_BINARY" "$@"
